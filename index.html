<html>
	<head>
		<link rel="stylesheet" type="text/css" href="styles.css">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- jQuery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<link href='https://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
	</head>
	<body>
	  <div class="row">
		  <div class="col-md-3" id="user-input">

		  	<div class="user-header">
		  		<div class="title">MOSC</div>
		  		<div class="description">Multiplexing Oversubscribed Circuits</div>
		  	</div>

		  	<form action="https://moscbackend.nicholas-fong.com/api/v1/call">
		  		Make emergency call:<br>
		  		<input type="text" name="number" class="input-field" placeholder="Number"><br>
			    <input type="submit" value="Submit" class="submit">
			  </form>

			  <form action="moscbackend.nicholas-fong.com/api/v1/call">
		  		Make non-emergency call:<br>
		  		<input type="text" name="number" class="input-field" placeholder="Number"><br>
			    <input type="submit" value="Submit" class="submit">
			  </form>

			  <form action="moscbackend.nicholas-fong.com/api/v1/call">
		  		Send SMS:<br>
		  		<input type="text" name="number" class="input-field" placeholder="Number"><br>
		  		<input type="text" name="message" class="input-field" placeholder="Message"><br>
			    <input type="submit" value="Submit" class="submit">
			  </form>

		  	<form action="https://moscbackend.nicholas-fong.com/api/v1/url">
			    Visit website:<br>
			    <input type="text" name="url" class="input-field" placeholder="Website Url"><br>
			    <input type="submit" value="Submit" class="submit">
				</form>
		  </div>
		  <div class="col-md-9 analytics">

		  	<div class="analytics-header">
		  		Analytics Dashboard
		  	</div>
		  	
		  	<div class="analytics-data">
		  		
		  		<div class="chart ecall-chart"></div>
		  		<br />
					<div class="chart call-chart"></div>
					<br />
					<div class="chart sms-chart"></div>
					<br />
					<div class="chart web-chart"></div>
		  	</div>
		  </div>
		</div>
	</body>

	<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script>

		var ecall_data = [0, 0]; // [received, served]
		var call_data = [0, 0];
		var sms_data = [0, 0];
		var web_data = [0, 0];

		d3.selectAll(".chart")
		  .selectAll("div")
		    .data(ecall_data)
		  .enter().append("div")
		    .style("width", function(d) {
		    	return 10 + "px"; 
		    })
		    .text(function(d) { return d; });

		var parser, xmlDoc;

		setInterval(function(){
	    $.ajax({ url: "https://mosc.nicholas-fong.com/api/v1/stats", success: function(data){


	    	parser = new DOMParser();
				xmlDoc = parser.parseFromString(data,"text/xml");

				var received = xmlDoc.getElementsByTagName("received");
				var served = xmlDoc.getElementsByTagName("served");
				// alert(rec[0].childNodes[0].nodeValue)
				// alert(rec.length);
				ecall_data[0] = received[0].childNodes[0].nodeValue;
				ecall_data[1] = served[0].childNodes[0].nodeValue;
				call_data[0] = received[1].childNodes[0].nodeValue;
				call_data[1] = served[1].childNodes[0].nodeValue;
				sms_data[0] = received[2].childNodes[0].nodeValue;
				sms_data[1] = served[2].childNodes[0].nodeValue;
				web_data[0] = received[3].childNodes[0].nodeValue;
				web_data[1] = served[3].childNodes[0].nodeValue;
        
	    }, dataType: "text"});

	    d3.select(".ecall-chart")
			  .selectAll("div")
			    .data(ecall_data)
			    .style("width", function(d) { 
			    	var sum = ecall_data[0] + ecall_data[1]; 
		    		return d / sum * 300 + "px";
			    })
			  	.text(function(d) { return d; });

			d3.select(".call-chart")
			  .selectAll("div")
			    .data(call_data)
			    .style("width", function(d) { 
			    	var sum = call_data[0] + call_data[1]; 
		    		return d / sum * 300 + "px";
			    })
			  	.text(function(d) { return d; });

			d3.select(".sms-chart")
			  .selectAll("div")
			    .data(sms_data)
			    .style("width", function(d) { 
			    	var sum = sms_data[0] + sms_data[1]; 
		    		return d / sum * 300 + "px";
			    })
			  	.text(function(d) { return d; });

			d3.select(".web-chart")
			  .selectAll("div")
			    .data(web_data)
			    .style("width", function(d) { 
			    	var sum = web_data[0] + web_data[1]; 
		    		return d / sum * 300 + "px";
			    })
			  	.text(function(d) { return d; });
			  	
		}, 5000);
	</script>
</html>